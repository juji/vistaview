---
const googleMapsApiKey = import.meta.env.VITE_GOOGLE_MAPS_API_KEY;
const mapboxAccessToken = import.meta.env.VITE_MAPBOX_ACCESS_TOKEN;
---

<section class="extensions-section">
	<div>
		<h2>Extensions</h2>
		<p>
			Extend VistaView's functionality with powerful extensions. From video support to interactive controls, extensions let you customize your image galleries to fit your specific needs.
		</p>

		<div class="extensions-grid">
			<div class="extension-card">
				<h3>Video Support</h3>
				<p>Embed videos from popular platforms directly in your galleries. Supports <a href="/extensions/youtube-video"><strong>YouTube</strong></a>, <a href="/extensions/vimeo-video"><strong>Vimeo</strong></a>, <a href="/extensions/dailymotion-video"><strong>Dailymotion</strong></a>, <a href="/extensions/wistia-video"><strong>Wistia</strong></a>, <a href="/extensions/vidyard-video"><strong>Vidyard</strong></a>, and <a href="/extensions/streamable-video"><strong>Streamable</strong></a>.</p>
			</div>

			<div class="extension-card">
				<h3>Interactive Controls & Advanced Features</h3>
				<p>Add custom controls and user interactions to your galleries. Includes <a href="/extensions/download"><strong>Download</strong></a> for saving images, <a href="/extensions/logger"><strong>Logger</strong></a> for debug information, and <a href="/extensions/image-story"><strong>Image Story</strong></a> for extended information about your image.</p>
			</div>

			<div class="extension-card">
				<h3>Maps Integration</h3>
				<p>Display interactive maps in your image galleries. Integrates with <a href="/extensions/google-maps"><strong>Google Maps</strong></a>, <a href="/extensions/mapbox"><strong>Mapbox</strong></a>, and <a href="/extensions/openstreetmap"><strong>OpenStreetMap</strong></a>.</p>
			</div>
		</div>

		</div>
	</div>
	<div>
		<div class="extensions-demo">
			<div class="extensions-gallery">
				<a href="https://picsum.photos/seed/demo1/800/600" target="_blank" rel="noopener" class="gallery-link">
					<img src="https://picsum.photos/seed/demo1/400/300" alt="Demo image with extensions" />
				</a>
				<a href="https://picsum.photos/seed/demo2/800/600" target="_blank" rel="noopener" class="gallery-link">
					<img src="https://picsum.photos/seed/demo2/400/300" alt="Another demo image" />
				</a>
        <a href="https://picsum.photos/seed/demo3/800/600" target="_blank" rel="noopener" class="gallery-link">
					<img src="https://picsum.photos/seed/demo3/400/300" alt="Another demo image" />
				</a>
			</div>
		</div>
	</div>
</section>


<link rel="stylesheet" href="https://unpkg.com/vistaview/dist/styles/extensions/image-story.css" />
<script src="https://unpkg.com/vistaview/dist/extensions/logger.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/download.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/image-story.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/youtube-video.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/dailymotion-video.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/vimeo-video.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/wistia-video.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/vidyard-video.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/streamable-video.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/google-maps.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/mapbox.umd.js"></script>
<script src="https://unpkg.com/vistaview/dist/extensions/openstreetmap.umd.js"></script>
<script type="module" is:inline define:vars={{ googleMapsApiKey, mapboxAccessToken }}>
	window.addEventListener('DOMContentLoaded', async function() {

    console.log('Loading video thumbnails for extensions demo...');

    const videoUrl = 'https://www.youtube.com/watch?v=GwJrZBe8JX4';
    const thumbnailUrl = window.VistaView.getYouTubeThumbnail(videoUrl, 'hq');

    const dailimotionVideoUrl = 'https://www.dailymotion.com/video/x7xvssw';
    const dailymotionThumbnailUrl = window.VistaView.getDailymotionThumbnail(dailimotionVideoUrl);

    const vimeoVideoUrl = 'https://vimeo.com/30673387';
    const vimeoThumbnailUrl = window.VistaView.getVimeoThumbnail(vimeoVideoUrl);

    const wistiaVideoUrl = 'https://jujiyangasli.wistia.com/medias/5tel0p2wua';
    const wistiaThumbnailUrl = await window.VistaView.getWistiaThumbnail(wistiaVideoUrl);

    const vidyardVideoUrl = 'https://share.vidyard.com/watch/GRJFiCEc9uSqJELta26in3';
    const vidyardThumbnailUrl = window.VistaView.getVidyardThumbnail(vidyardVideoUrl);

    const streamableVideoUrl = 'https://streamable.com/0skbol';
    const streamableThumbnailUrl = window.VistaView.getStreamableThumbnail(streamableVideoUrl);

    // Example map locations
    const googleMapsUrl = 'https://www.google.com/maps/@40.7128,-74.0060,15z'; // New York City
    const googleMapsLocation = { lat: 40.7128, lng: -74.0060, zoom: 15 };
    const googleMapsThumbnail = googleMapsApiKey 
      ? window.VistaView.getGoogleMapsStaticImage(googleMapsLocation, { apiKey: googleMapsApiKey, zoom: 15 })
      : 'https://via.placeholder.com/400x300?text=Google+Maps+%28API+Key+Required%29';

    const mapboxUrl = 'mapbox://-74.0060,40.7128,15'; // New York City
    const mapboxLocation = { lng: -74.0060, lat: 40.7128, zoom: 15 };
    const mapboxThumbnail = mapboxAccessToken
      ? window.VistaView.getMapboxStaticImage(mapboxLocation, { accessToken: mapboxAccessToken, zoom: 15 })
      : 'https://via.placeholder.com/400x300?text=Mapbox+%28Access+Token+Required%29';

    const osmUrl = 'https://www.openstreetmap.org/#map=15/40.7128/-74.0060'; // New York City
    const osmLocation = { lat: 40.7128, lng: -74.0060, zoom: 15 };
    const osmThumbnail = window.VistaView.getOpenStreetMapStaticImage(osmLocation, { zoom: 15 });

    // Add video thumbnails to gallery
    const gallery = document.querySelector('.extensions-gallery');
    function addThumbToGallery(url, thumbnail, alt, className) {
      const link = document.createElement('a');
      link.href = url;
      link.target = '_blank';
      link.rel = 'noopener';
      link.classList.add(className);
      const img = document.createElement('img');
      img.src = thumbnail;
      img.alt = alt;
      link.appendChild(img);
      gallery.appendChild(link);
    }

    addThumbToGallery(videoUrl, thumbnailUrl, 'YouTube video', 'gallery-link');
    addThumbToGallery(dailimotionVideoUrl, dailymotionThumbnailUrl, 'Dailymotion video', 'gallery-link');
    addThumbToGallery(vimeoVideoUrl, vimeoThumbnailUrl, 'Vimeo video', 'gallery-link');
    addThumbToGallery(wistiaVideoUrl, wistiaThumbnailUrl, 'Wistia video', 'gallery-link');
    addThumbToGallery(vidyardVideoUrl, vidyardThumbnailUrl, 'Vidyard video', 'gallery-link');
    addThumbToGallery(streamableVideoUrl, streamableThumbnailUrl, 'Streamable video', 'gallery-link');
    addThumbToGallery(googleMapsUrl, googleMapsThumbnail, 'Google Maps location', 'gallery-link');
    addThumbToGallery(mapboxUrl, mapboxThumbnail, 'Mapbox location', 'gallery-link');
    addThumbToGallery(osmUrl, osmThumbnail, 'OpenStreetMap location', 'gallery-link');

		if (window.VistaView && window.VistaView.vistaView) {
			window.VistaView.vistaView({ 
				elements: '.extensions-gallery a',
        controls: {
          topRight: ['zoomIn', 'zoomOut',  'download', 'close'],
          bottomCenter: ['imageStory'],
        },
				extensions: [
					window.VistaView.logger(),
					window.VistaView.download(),
					window.VistaView.imageStory({
          getStory: async (index) => ({
              content: `
              <p style="margin-top: 0">This is a description for image #${index + 1}. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
              <p>This is some additional random text for the image story. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
              <p>More random content: Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident.</p>
              <p style="margin-bottom: 0">end of story.</p>
              `,
              onLoad: () => {
                console.log(`Story for image #${index + 1} loaded.`);
              },
              onUnload: () => {
                console.log(`Story for image #${index + 1} unloaded.`);
              },
            })
          }),
					window.VistaView.youtubeVideo(),
					window.VistaView.dailymotionVideo(),
					window.VistaView.vimeoVideo(),
					window.VistaView.wistiaVideo(),
					window.VistaView.vidyardVideo(),
					window.VistaView.streamableVideo(),
					window.VistaView.googleMaps({
            apiKey: googleMapsApiKey,
          }),
					window.VistaView.mapbox({
            accessToken: mapboxAccessToken,
          }),
					window.VistaView.openStreetMap()
				]
			});
		}
	});
</script>

<style is:global>
  a.gallery-link {
		display: block;
		border-radius: 0.25rem;
		overflow: hidden;
		transition: transform 0.2s ease;
    height: 120px;
	}

  a.gallery-link:hover {
		transform: scale(1.05);
	}

  .extensions-gallery {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
		gap: 1rem;
	}

	.extensions-gallery img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}
</style>

<style>
	.extensions-section {
		padding: 2rem 0;
		text-align: start;

		@media screen and (min-width: 50rem) {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 2rem;
		}
	}

	.extensions-section h2 {
		font-size: var(--sl-text-2xl);
		margin-bottom: 1rem;
	}

	.extensions-section p {
		max-width: 60ch;
		margin: 0 0 2rem 0;
		color: var(--sl-color-gray-2);
	}

	.extensions-grid {
		margin-bottom: 3rem;
	}

	.extension-card {
		margin-bottom: 2rem;
	}

	.extension-card h3 {
		font-size: var(--sl-text-lg);
		margin: 0 0 0.5rem 0;
		color: var(--sl-color-text);
	}

	.extension-card strong {
		color: #22c55e;
		font-weight: 600;
	}

	.extension-card a {
		text-decoration: none;
		transition: opacity 0.2s ease;
	}

	.extension-card a:hover {
		opacity: 0.8;
	}

	.extension-card p {
		margin: 0 0 1rem 0;
		color: var(--sl-color-gray-3);
		font-size: var(--sl-text-sm);
	}

	.extensions-demo {
		padding: 0;
	}
</style>