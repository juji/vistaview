---
import { Image } from 'astro:assets';
import LinkButton from '../../node_modules/@astrojs/starlight/user-components/LinkButton.astro';
import HeroContentBox from './home/HeroContentBox.astro';

import pkg from '../../../package.json';
const VISTAVIEW_VERSION = pkg.version;

const PAGE_TITLE_ID = '_top';

const { data } = Astro.locals.starlightRoute.entry;
const { title = data.title, image, actions = [] } = data.hero || {};

const imageAttrs = {
	loading: 'eager' as const,
	decoding: 'async' as const,
	width: 400,
	height: 400,
	alt: image?.alt || '',
};

let darkImage: ImageMetadata | undefined;
let lightImage: ImageMetadata | undefined;
let rawHtml: string | undefined;
if (image) {
	if ('file' in image) {
		darkImage = image.file;
	} else if ('dark' in image) {
		darkImage = image.dark;
		lightImage = image.light;
	} else {
		rawHtml = image.html;
	}
}
---

<div class="hero">
	{
		darkImage && (
			<>
				<Image src={darkImage} {...imageAttrs} class:list={{ 'light:sl-hidden': Boolean(lightImage) }} />
				{lightImage && <Image src={lightImage} {...imageAttrs} class="dark:sl-hidden" />}
			</>
		)
	}
	{rawHtml && <div class="hero-html sl-flex" set:html={rawHtml} />}
	
	<HeroContentBox />
	
	<div class="sl-flex stack main-left">
		<div class="sl-flex copy">
			<h1 id={PAGE_TITLE_ID} data-page-title>
				{title} <span class="version-badge">{VISTAVIEW_VERSION}</span>
			</h1>
			<div class="tagline">
				A lightweight, modern image lightbox library for the web. Zero&nbsp;dependencies, and highly customizable.
			</div>
		</div>
		{
			actions.length > 0 && (
				<>
					<p class="framework-text">Pick your flavour:</p>
					<div class="framework-buttons">
						{actions.slice(0, 5).map(
							({ attrs: { class: className, ...attrs } = {}, icon, link: href, text, variant }) => (
								<div class="framework-button">
									<LinkButton {href} {variant} icon={typeof icon === 'string' ? undefined : icon?.name} class:list={[className]} {...attrs}>
										{ (typeof icon === 'string' ? icon : icon?.html) && <Fragment set:html={typeof icon === 'string' ? icon : icon?.html} />}
										{text}
									</LinkButton>
								</div>
							)
						)}
					</div>
					<div class="action-buttons">
						{actions.slice(5).map(
							({ attrs: { class: className, ...attrs } = {}, icon, link: href, text, variant }, index) => (
								<LinkButton {href} {variant} icon={typeof icon === 'string' ? undefined : icon?.name} class:list={[className, index === 0 ? 'docs-button' : 'github-button']} {...attrs}>
									{ (typeof icon === 'string' ? icon : icon?.html) && <Fragment set:html={typeof icon === 'string' ? icon : icon?.html} />}
									{text}
								</LinkButton>
							)
						)}
					</div>
				</>
			)
		}
	</div>
</div>

<style>
	@layer starlight.core {

		.main-left{
			gap: 1rem !important;
		}

		.hero {
			display: grid;
			align-items: center;
			gap: 1rem;
			padding-bottom: 1rem;

			@media screen and (min-width: 50rem) {
				grid-template-columns: 4fr 4fr !important;
			}
		}

		.hero > img,
		.hero > .hero-html {
			object-fit: contain;
			width: min(70%, 20rem);
			height: auto;
			margin-inline: auto;
		}

		.stack {
			flex-direction: column;
			gap: clamp(1.5rem, calc(1.5rem + 1vw), 2rem);
			text-align: center;
		}

		.copy {
			flex-direction: column;
			gap: 1rem;
			align-items: center;
		}

		.copy > * {
			max-width: 50ch;
		}

		h1 {
			font-size: clamp(var(--sl-text-3xl), calc(0.25rem + 5vw), var(--sl-text-6xl));
			line-height: var(--sl-line-height-headings);
			font-weight: 600;
			color: var(--sl-color-white);
		}

		.tagline {
			font-size: clamp(var(--sl-text-base), calc(0.0625rem + 2vw), var(--sl-text-xl));
			color: var(--sl-color-gray-2);
			max-width: 512px;
		}

		.framework-text {
			font-size: var(--sl-text-lg);
			font-weight: 600;
			color: var(--sl-color-white);
			margin: 0;
			text-align: center;
		}

		.framework-buttons {
			display: flex;
			flex-wrap: wrap;
			gap: 2rem;
			justify-content: center;
			max-width: 200px;
			margin: 0 auto;

			@media screen and (min-width: 400px) {
				max-width: 100%;	
			}

			@media screen and (min-width: 800px) {
				margin: 0;
				justify-content: flex-start;
			}
		}

		.action-buttons {
			display: flex;
			gap: 1rem;
			justify-content: center;
			flex-wrap: wrap;
			margin-top: 1rem;
		}

		.action-buttons .sl-link-button {
			gap: 1rem !important;
			border-radius: 999px;
			padding: 0.75rem 1.5rem !important;
			font-weight: 600;
			transition: all 0.2s ease;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
		}

		.action-buttons .sl-link-button:hover {
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
		}

		.action-buttons .docs-button {
			background: #0b7954;
			color: white;
		}

		.action-buttons .docs-button:hover {
			background: #059669;
		}

		.action-buttons .github-button {
			background: #2d2d2d;
			color: white;
		}

		.action-buttons .github-button:hover {
			background: #3d3d3d;
		}

		.framework-button {
			display: flex;
			gap: 1rem;
		}

		.framework-button .sl-link-button {
			display: flex !important;
			flex-direction: column !important;
			align-items: center;
			gap: 0.25rem;
		}

	.version-badge {
		font-size: 0.5em;
		font-weight: 300;
		opacity: 0.6;
		margin-left: 0.5em;
	}

	@media (min-width: 50rem) {
		.version-badge {
			font-size: 0.3em;
		}

		.hero {
			gap: 3%;
			padding-block: clamp(2.5rem, calc(1rem + 10vmin), 10rem);
		}

		.hero > img,
		.hero > .hero-html {
			order: 2;
			width: min(100%, 25rem);
		}

		.stack {
			text-align: start;
		}

		.copy {
			align-items: flex-start;
		}

		.framework-text {
			text-align: start;
		}

		.action-buttons {
			justify-content: flex-start;
		}

		/* Position box on the right on wide screens */
		:global(.hero-content-box) {
			grid-column: 2;
			grid-row: 1 / 3;
			margin-bottom: 0;
			align-self: start;
		}
	}
}
</style>